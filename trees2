library(ISLR)
dataset <- data.frame(t(data.matrix))
dataset2 <- t(data.matrix)
dataset3 <- data.frame(eset)
dataset4 <- t(eset)

y <- data.labels
library(tree) 

# install party package
library(party)
# this creates a fatal error in r:
# mytree <- ctree(y ~ ., data=dataset3)
#dataset5 <- dataset3[,1:5000]
#mytree <- ctree(y ~ ., data=dataset5)

#summary(mytree)
#print(mytree)
#plot(mytree) 
#text(mytree)
#mytree


#trainset.fit<-tree(y~dataset2, data=dataset) 
dataset6 <- dataset3[,1:5000]
trainset.fit<-tree(y~., data=dataset6) 

summary(trainset.fit)
print(trainset.fit)
plot(trainset.fit) 
text(trainset.fit)
trainset.fit

install.packages('randomForest')
library(randomForest)
# this runs for a long time - may need to optimize mtry and ntree
# should also add a seed.
#forestfit <- randomForest(y~., data=dataset6, importance=TRUE, mtry=10000, ntree=10000)
forestfit <- randomForest(y~., data=dataset6, importance=TRUE, mtry=10000, ntree=10000)
varImpPlot(forestfit)
importTree <- importance(forestfit, type=1)
importTree2 <- importTree*importTree
importFactors = apply(importTree2, 1, function(row) all(row > 6))
fac <- importTree[importFactors,]
fac <- fac[order(fac)]
#source("http://bioconductor.org/biocLite.R")
#biocLite("illuminaHumanv4.db")

library(illuminaHumanv4.db)

#x <- "ILMN_1683678"
#symbols <- mapIds(illuminaHumanv4.db, x, "SYMBOL","PROBEID")
symbols <- mapIds(illuminaHumanv4.db, names(fac), "SYMBOL","PROBEID")
symbols

dataset7 <- dataset3[,1:1000]
forestfit <- randomForest(y~., data=dataset7, importance=TRUE, ntree=10000)
varImpPlot(forestfit)
importTree <- importance(forestfit, type=1)
importTree2 <- importTree*importTree
importFactors = apply(importTree2, 1, function(row) all(row > 10))
fac <- importTree[importFactors,]
fac <- fac[order(fac)]
symbols <- mapIds(illuminaHumanv4.db, names(fac), "SYMBOL","PROBEID")
symbols
fac



fac.append = 0

for (i in 0:47){
  start = 1+i*1000
  end = 1000+i*1000
  dataset7 <- dataset3[,start:end]
  forestfit <- randomForest(y~., data=dataset7, importance=TRUE, ntree=10000)
  varImpPlot(forestfit)
  importTree <- importance(forestfit, type=1)
  importTree2 <- importTree*importTree
  importFactors = apply(importTree2, 1, function(row) all(row > 10))
  fac <- importTree[importFactors,]
  fac <- fac[order(fac)]
  symbols <- mapIds(illuminaHumanv4.db, names(fac), "SYMBOL","PROBEID")
  symbols
  fac.append = append(fac.append,fac)
  
}


dataset7 <- dataset3[,47000:48107]
forestfit <- randomForest(y~., data=dataset7, importance=TRUE, ntree=10000)
varImpPlot(forestfit)
importTree <- importance(forestfit, type=1)
importTree2 <- importTree*importTree
importFactors = apply(importTree2, 1, function(row) all(row > 10))
fac <- importTree[importFactors,]
fac <- fac[order(fac)]
symbols <- mapIds(illuminaHumanv4.db, names(fac), "SYMBOL","PROBEID")
symbols
fac.append = append(fac.append,fac)


fac.append <- fac.append[order(fac.append)]
fac.append
symbols <- mapIds(illuminaHumanv4.db, names(fac.append), "SYMBOL","PROBEID")
symbols

initialVals1 = apply(fac.append, 1, function(x) all(x > 7))
initialVals1


lines = 1
for (i in 1:length(fac.append)){
  if (fac.append[i]>0) {
     line = which(dataset3 == names(fac.append[i]))
     if (length(line)>0){
        lines = append(lines, line()[[1]])
     }
  }
}


dataset7 <- dataset3[,t(lines)]
forestfit <- randomForest(y~., data=dataset7, importance=TRUE, mtry=10000, ntree=10000)
varImpPlot(forestfit)
importTree <- importance(forestfit, type=1)
importTree2 <- importTree*importTree
importFactors = apply(importTree2, 1, function(row) all(row > 6))
fac <- importTree[importFactors,]
fac <- fac[order(fac)]
symbols <- mapIds(illuminaHumanv4.db, names(fac), "SYMBOL","PROBEID")
symbols
fac
